
module Inferno
  module Sequence
    class USCoreR4_<%=name%>_Sequence < SequenceBase

      group 'US Core R4 Profile Conformance'

      title 'US Core R4 <%= resource %> Tests'

      description 'Verify that <%=resource%> resources on the FHIR server follow the Argonaut Data Query Implementation Guide'

      test_id_prefix '<%=resource%>' # change me

      requires :token, :patient_id
      conformance_supports :<%=resource%>

      def validate_resource_item (resource, property, value)
        case property
        when "patient"
          assert (resource.patient && resource.patient.reference.include?(value)), "Patient on resource does not match patient requested"
        end
      end

      details %(
      )

      @resources_found = false
      <% tests.each do |test|%>
      test '<%=test[:tests_that]%>' do
        metadata {
          id '<%=test[:index]%>'
          link '<%=test[:link]%>'
          desc %(
          )
          versions :r4
        }
        <%=test[:test_code]%>
      end
      <% end%>
    end
  end
end